{"version":3,"sources":["/demos/node-app/app.js"],"sourcesContent":["(function (exports, require, module, __filename, __dirname) { const express = require('express');\nconst bodyParser = require('body-parser');\nconst path = require('path');\nconst fs = require('fs');\nconst { exec } = require('child_process');\nconst os = require('os');\n\nconst app = express();\nconst PORT = process.env.PORT || 3030;\n\n// Middleware\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use(express.static('public'));\n\n// Set EJS as template engine\napp.set('view engine', 'ejs');\napp.set('views', path.join(__dirname, 'views'));\n\n// Routes\n\n// Home page\napp.get('/', (req, res) => {\n    res.render('index', { \n        title: 'Node.js Security Demo with Contrast',\n        timestamp: new Date().toISOString()\n    });\n});\n\n// API Routes\napp.get('/api/info', (req, res) => {\n    const info = {\n        timestamp: new Date().toISOString(),\n        platform: os.platform(),\n        nodejs_version: process.version,\n        architecture: os.arch(),\n        hostname: os.hostname(),\n        uptime: os.uptime(),\n        memory: {\n            total: Math.round(os.totalmem() / 1024 / 1024) + ' MB',\n            free: Math.round(os.freemem() / 1024 / 1024) + ' MB'\n        },\n        environment_vars: {\n            NODE_ENV: process.env.NODE_ENV || 'Not set',\n            PATH: process.env.PATH ? process.env.PATH.split(':').slice(0, 5) : [],\n            CONTRAST_URL: process.env.CONTRAST_URL || 'Not configured'\n        }\n    };\n    res.json(info);\n});\n\napp.get('/api/hello/:name?', (req, res) => {\n    const name = req.params.name || 'World';\n    const response = {\n        message: `Hello, ${name}!`,\n        timestamp: new Date().toISOString(),\n        visitor: name\n    };\n    res.json(response);\n});\n\napp.get('/health', (req, res) => {\n    const health = {\n        status: 'healthy',\n        timestamp: new Date().toISOString(),\n        app: 'Node.js Demo App',\n        uptime: process.uptime()\n    };\n    res.json(health);\n});\n\n// VULNERABLE ENDPOINTS - FOR DEMO/TESTING PURPOSES ONLY\n// DO NOT USE IN PRODUCTION\n\napp.get('/vulnerable/file-read', (req, res) => {\n    const filename = req.query.filename || 'package.json';\n    \n    console.log(`[DEBUG] file-read endpoint called with filename: '${filename}' (length: ${filename?.length || 0})`);\n    \n    try {\n        // VULNERABILITY: Path Traversal - No path sanitization\n        let filePath;\n        \n        // If filename starts with /, treat as absolute path\n        if (filename.startsWith('/')) {\n            filePath = filename;\n        } else {\n            // Try to find the file in the node-app directory first, then /demos\n            const appFilePath = path.join('/demos/node-app', filename);\n            const demosFilePath = path.join('/demos', filename);\n            \n            if (fs.existsSync(appFilePath)) {\n                filePath = appFilePath;\n            } else if (fs.existsSync(demosFilePath)) {\n                filePath = demosFilePath;\n            } else {\n                filePath = appFilePath; // Default to app directory for error reporting\n            }\n        }\n        \n        console.log(`[DEBUG] Attempting to read file: '${filePath}'`);\n        const content = fs.readFileSync(filePath, 'utf8');\n        \n        res.json({\n            filename: filename,\n            content: content,\n            warning: 'This endpoint has a path traversal vulnerability for demo purposes'\n        });\n    } catch (error) {\n        res.status(400).json({\n            error: error.message,\n            filename: filename,\n            warning: 'This endpoint has a path traversal vulnerability for demo purposes'\n        });\n    }\n});\n\napp.get('/vulnerable/command', (req, res) => {\n    const cmd = req.query.cmd || '';\n    \n    console.log(`[DEBUG] command endpoint called with cmd: '${cmd}' (length: ${cmd?.length || 0})`);\n    \n    if (!cmd) {\n        return res.status(400).json({\n            error: \"No command provided in 'cmd' parameter\",\n            warning: 'This endpoint has a command injection vulnerability for demo purposes'\n        });\n    }\n\n    try {\n        // VULNERABILITY: Command Injection - Direct process execution\n        exec(cmd, { timeout: 10000 }, (error, stdout, stderr) => {\n            if (error) {\n                return res.status(400).json({\n                    error: error.message,\n                    command: cmd,\n                    warning: 'This endpoint has a command injection vulnerability for demo purposes'\n                });\n            }\n\n            res.json({\n                command: cmd,\n                stdout: stdout,\n                stderr: stderr,\n                warning: 'This endpoint has a command injection vulnerability for demo purposes'\n            });\n        });\n    } catch (error) {\n        res.status(400).json({\n            error: error.message,\n            command: cmd,\n            warning: 'This endpoint has a command injection vulnerability for demo purposes'\n        });\n    }\n});\n\napp.get('/vulnerable/ping', (req, res) => {\n    const host = req.query.host || 'localhost';\n    \n    console.log(`[DEBUG] ping endpoint called with host: '${host}' (length: ${host?.length || 0})`);\n    \n    try {\n        // VULNERABILITY: Command Injection via string concatenation\n        const command = `ping -c 4 ${host}`;\n        \n        exec(command, { timeout: 15000 }, (error, stdout, stderr) => {\n            res.json({\n                host: host,\n                command: command,\n                output: stdout,\n                error: stderr || (error ? error.message : null),\n                warning: 'This endpoint has a command injection vulnerability for demo purposes'\n            });\n        });\n    } catch (error) {\n        res.status(400).json({\n            error: error.message,\n            host: host,\n            warning: 'This endpoint has a command injection vulnerability for demo purposes'\n        });\n    }\n});\n\n// Contrast agent information\napp.get('/contrast', (req, res) => {\n    const contrastInfo = {\n        agent: 'Contrast Node.js Agent',\n        version: '4.5.0',\n        mode: ['Assess', 'Inventory'],\n        status: 'Active',\n        teamserver: process.env.CONTRAST_URL || 'Not configured',\n        features: [\n            'Real-time vulnerability detection',\n            'Runtime application security monitoring',\n            'Code-level security insights',\n            'Attack detection and blocking'\n        ],\n        documentation: 'https://docs.contrastsecurity.com'\n    };\n    res.json(contrastInfo);\n});\n\n// Contrast page\napp.get('/contrast-info', (req, res) => {\n    res.render('contrast', { \n        title: 'Contrast Security Information'\n    });\n});\n\n// Debug endpoint\napp.get('/debug/files', (req, res) => {\n    const info = {\n        current_directory: process.cwd(),\n        views_exist: fs.existsSync('views'),\n        index_view_exists: fs.existsSync('views/index.ejs'),\n        contrast_view_exists: fs.existsSync('views/contrast.ejs'),\n        package_json_exists: fs.existsSync('package.json'),\n        files_in_current_dir: fs.readdirSync('.').slice(0, 10)\n    };\n    res.json(info);\n});\n\n// Start server\napp.listen(PORT, '0.0.0.0', () => {\n    console.log(`üöÄ Starting Node.js app on port ${PORT}`);\n    console.log(`üåê Access the app at: http://localhost:${PORT}`);\n    console.log(`üìä Health check: http://localhost:${PORT}/health`);\n    console.log(`üîß System info API: http://localhost:${PORT}/api/info`);\n    console.log(`‚ö†Ô∏è Vulnerability testing available on home page`);\n    console.log(`üîÑ View updated at: ${new Date()}`);\n});\n\n}).apply(this, arguments);"],"names":["exports","require","module","__filename","__dirname","express","bodyParser","path","fs","exec","os","app","PORT","process","env","use","urlencoded","extended","json","static","set","join","get","req","res","render","title","timestamp","Date","toISOString","info","platform","nodejs_version","version","architecture","arch","hostname","uptime","memory","total","Math","round","totalmem","free","freemem","environment_vars","NODE_ENV","PATH","split","slice","CONTRAST_URL","name","params","response","message","visitor","health","status","filename","query","console","log","length","filePath","startsWith","appFilePath","demosFilePath","existsSync","content","readFileSync","warning","error","cmd","timeout","stdout","stderr","command","host","output","contrastInfo","agent","mode","teamserver","features","documentation","current_directory","cwd","views_exist","index_view_exists","contrast_view_exists","package_json_exists","files_in_current_dir","readdirSync","listen","apply","arguments"],"mappings":"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"}